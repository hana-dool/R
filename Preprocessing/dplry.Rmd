---
output: rmarkdown::github_document
editor_options: 
  chunk_output_type: console
---

```{r results='hide', message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(rmarkdown)
library(knitr)
```

```{r}
id <- c(1,2,3,4,5,6)
class <- c(2,1,2,1,1,2)
english <- c(98,97,86,98,80,89)
science <- c(50,60,78,58,65,98)
data <- data.frame(id,class,english,science) ; data
```
# 1.ê¸°ì´ˆì§€?‹
### ?ŒŒ?´?”„ ?—°?‚°? [%>%]
?•¨?ˆ˜?˜ ì¶œë ¥?´ ê·? ?‹¤?Œê°’ìœ¼ë¡? ë°”ë¡œ ?“¤?–´ê°€?Š”ê²?  
%>% ?•¨?ˆ˜1 %>% ?•¨?ˆ˜2(?•¨?ˆ˜1?˜ ê°’ì„ ?´?š©) %>%.....  

function (dataframe,arg1,arg2) ?´?¼?Š” ?•¨?ˆ˜??€ ?•„?˜ %>% ?—´ë¡? ?•©ì³ì§„ êµ¬ë¬¸??€ ê°™ì?€ ?‘œ?˜„?´?‹¤.
dataframe %>%  
function(arg1,ar2)  

# 2. Selct ??€ Filter

## Select 
?°?´?„° ?”„? ˆ?„?—?„œ ?‚´ê°€ ?›?•˜?Š” column ë§? ?„ ?ƒ?•˜ê²? ?•˜?Š” êµ¬ë¬¸. 
```{r}
data %>% # ?°?´?„°ê°€ slect ?˜ ?…? ¥?œ¼ë¡? ?“¤?–´ê°?
  select(class,english) # class, english ë§? ?‘œì¶œí•´?¼
```

## Filter
?Š¹? • row ë§? ë½‘ê³ ?‹¶?„?•Œ
```{r}
data %>%
  filter(class==1) # class ê°€ 1ë°˜ì¸ observation ë§? ë³´ê³  ?‹¶?‹¤?Š” ?œ».
```
<= > != ?“± ë§ì?€ operator ê°€ ê°€?Š¥?•˜?‹¤.   
is.na (missing value ê°€ ?ˆ?Š?ƒ ?—†?Š?ƒ)   
logical operator ë¥? ?‹¤?–‘?•˜ê²? ?‚¬?š©?•´?„œ filter ê³? ê°™ì´ ?‚¬?š©?•  ?ˆ˜ ?ˆ?‹¤.   


# EX
?‹¤?´?•„ëª¬ë“œ ê°€ê²©ì´ 950 ?´?•˜?´ê³?, 800?´?ƒ?¸ ê²ƒë§Œ ê³ ë?? ?•Œ
```{r}
diamonds %>%
  filter(price <= 950 & price >= 800)
```

```{r}
# cë¡? ?‹œ?‘?•˜?Š” ë³€?ˆ˜?“¤ë§? ?„ ?ƒ
diamonds %>%
  select(starts_with("c"))

# ë³€?ˆ˜?˜ ??‚˜?Š” ?Š¤? ë§?
diamonds %>%
  select(ends_with("e"))

# ë³€?ˆ˜?— ?¬?•¨?œ ?Š¤? ë§? 
diamonds %>%
  select(contains("r"))

# ?Š¹? • ?œ„ì¹˜ì˜ ?„ ?ƒ
diamonds %>%
  select(1:4)

data %>%
  select(english,science) %>% # ?°?´?„°?—?„œ ?˜?–´??€ ê³¼í•™ col ë§? ?„ ?ƒ?•˜ê³?
  filter(science >= 70) %>% # ê·¸ë‹¤?Œ ê³¼í•™ ? ?ˆ˜?Š” 70?  ?´?ƒ?¸ê±°ë§Œ ê³ ë¥´ê³?
  head(2) # ê·¸ë‹¤?Œ 2ê°œì˜ row ë§? ì¶œë ¥
```

# Arrange
```{r}
data %>%
  arrange(id) # ?˜¤ë¦„ì°¨?ˆœ ? •? ¬

data %>%
  arrange(desc(id)) # ?‚´ë¦¼ì°¨?ˆœ ? •? ¬

data %>%
  arrange(id, desc(science)) # id ?Š” ?˜¤ë¦„ì°¨?ˆœ ê·¸ë¦¬ê³? science ?Š” ?‚´ë¦¼ì°¨?ˆœ ? •? ¬
# id ê°€ ë¨¼ì?€ ?ˆœ?œ„ê°€ ?œ?‹¤. 

data %>%
  mutate(total = english+science) # ?ƒˆë¡œìš´ total ?´?¼?Š” column ë³€?ˆ˜ê°€ ?“¤?–´ê°€ê²? ?œ?‹¤.

data%>%
  mutate(total = english+science) %>%
  mutate(mean = total/2) %>%
  mutate(test = ifelse(mean>=60,'pass','fail')) # ?´? ‡ê²? ifelse ë¥? ?“¸ ?ˆ˜ ?ˆ?Œ
```

# Summarize
```{R}
storm = data.frame(storms)
storm %>% # ?´? ‡ê²? ?•„?˜ì²˜ëŸ¼ summarise ê°€?Š¥
  summarise(n_obs = n(), # ì´? ëª‡ê°œ?¸ì§€ ?•Œê³ ì‹¶?‹¤ë©? n()
            max_wind = max(wind),
            min_wind = min(wind)) # ? œ?¼ ?•½?•œ ë°”ëŒ
```


# grouping 
```{R}
storm %>%
  group_by(name,year)  # name ê³? yearë¡? ?˜¤ë¦„ì°¨?ˆœ?œ¼ë¡? 

# --------- grouping + summarizing
storm %>%
  group_by(name,year) %>% # ?´ë¦„ê³¼, ?…„?„?— ??€?•´ grouping
  summarise(n_obs = n(), # ê°? group ?—?„œ ê°??ˆ˜ê°€ ëª‡ê°œ?
            max_wind = max(wind), # max wind ?Š” ?–¼ë§??
            min_wind = min(wind)) 
```

```{R}
# ------------ Use ?‚¬?š©? ? •?˜ ?•¨?ˆ˜
knot <- function(knot){
  mph <- 1.152 * knot
}
# ?œ„??€ ê°™ì´ ?•¨?ˆ˜ë¥? ë§Œë“ ?‹¤.

storm %>%
  summarise(n_obs = n(),
            max_wind = knot(max(wind))) # ?‹¤?Œê³? ê°™ì´ ë¯¸ë¦¬ ? •?˜?•œ ?•¨?ˆ˜ ?´?š© ê°€?Š¥
```

# ?°?´?„° ë³€?ˆ˜ ?´ë¦? ë³€?™˜
```{R}
diamonds <- diamonds %>%
  rename(width  = x,
         length = y,
         heigth = z)
colnames(diamonds)
```

# sampling ?•¨?ˆ˜
```{R}
# ? „ì²? ê´€ì¸¡ì¹˜ ì¤‘ì—?„œ 100ê°œë§Œ ë¹„ë³µ?› ì¶”ì¶œ
diamonds %>%
  sample_n(100)

# 100ê°œë§Œ ë³µì› ì¶”ì¶œ
diamonds %>%
  sample_n(100,
           replace = T)

# ? „ì²? ?°?´?„°ì¤‘ì— 30% ë¹„ë³µ?› ì¶”ì¶œ
diamonds %>%
  sample_frac(.3)

```

# Advanced working
```{R}
# group by ë¡? ?‘ê°? ë³€?ˆ˜?˜ combination ?— ??€?•´?„œ ê°? value ?“¤?˜ count
diamonds %>% 
  group_by(cut,color) %>%
  summarise(count = n())
# ?´? ‡ê²? ?•´?„ ?œ„??€ ê°™ë‹¤.
diamonds %>%
  count(cut,color) 

# group by ë¡? ?‘ê°? ë³€?ˆ˜?˜ combination?— ??€?•´?„œ, unique ?•œ clarity ?˜ count
diamonds %>% 
  group_by(cut ,color) %>%
  summarise(count = n_distinct(clarity))
# ì¦? fair cut, D color ?¸ ê²½ìš°?—, clarity ?˜ ì¢…ë¥˜?Š” 8ê°?
```


